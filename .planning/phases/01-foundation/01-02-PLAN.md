---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/hooks/useGameLoop.ts
  - src/components/Game.tsx
  - src/components/TimeDisplay.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Time advances automatically when game is running"
    - "Player can pause and resume time"
    - "Day counter and clock are visible"
    - "Time stops when paused"
  artifacts:
    - path: "src/hooks/useGameLoop.ts"
      provides: "Fixed-timestep game loop"
      exports: ["useGameLoop"]
    - path: "src/components/TimeDisplay.tsx"
      provides: "Day counter and time UI"
      contains: "observer"
    - path: "src/components/Game.tsx"
      provides: "Main game component running loop"
      contains: "useGameLoop"
  key_links:
    - from: "src/components/Game.tsx"
      to: "src/hooks/useGameLoop.ts"
      via: "hook usage"
      pattern: "useGameLoop"
    - from: "src/hooks/useGameLoop.ts"
      to: "src/stores/RootStore.ts"
      via: "tick callback"
      pattern: "store\\.tick"
    - from: "src/components/TimeDisplay.tsx"
      to: "src/stores/TimeStore.ts"
      via: "observer"
      pattern: "timeStore\\.(day|hour|formattedTime)"
---

<objective>
Implement the fixed-timestep game loop and time display UI components.

Purpose: This plan makes time observable. The player will see the day counter increment and can pause/resume the simulation. This is the core "game is running" signal.

Output: Running game loop that advances time, with visible day counter, clock, and pause/play button.
</objective>

<execution_context>
@/Users/godstemning/.claude/get-shit-done/workflows/execute-plan.md
@/Users/godstemning/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@src/stores/RootStore.ts
@src/stores/TimeStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useGameLoop hook with fixed timestep</name>
  <files>
    src/hooks/useGameLoop.ts
  </files>
  <action>
Create src/hooks/useGameLoop.ts implementing the fixed-timestep pattern from RESEARCH.md:

```typescript
import { useEffect, useRef } from 'react';

export function useGameLoop(
  onTick: (deltaMs: number) => void,
  options: {
    targetFps?: number;
    paused?: boolean;
    maxFrameTime?: number;
  } = {}
) {
  const { targetFps = 60, paused = false, maxFrameTime = 250 } = options;
  const lastTimeRef = useRef<number>(0);
  const accumulatorRef = useRef<number>(0);
  const tickInterval = 1000 / targetFps;

  useEffect(() => {
    if (paused) return;

    let animationId: number;

    const loop = (currentTime: number) => {
      const deltaMs = Math.min(currentTime - lastTimeRef.current, maxFrameTime);
      lastTimeRef.current = currentTime;
      accumulatorRef.current += deltaMs;

      while (accumulatorRef.current >= tickInterval) {
        onTick(tickInterval);
        accumulatorRef.current -= tickInterval;
      }

      animationId = requestAnimationFrame(loop);
    };

    lastTimeRef.current = performance.now();
    animationId = requestAnimationFrame(loop);

    return () => cancelAnimationFrame(animationId);
  }, [onTick, targetFps, paused, maxFrameTime, tickInterval]);
}
```

Key points:
- maxFrameTime=250ms prevents spiral of death after tab unfocus
- Fixed timestep (tickInterval) ensures deterministic simulation
- Accumulator pattern handles variable frame rates
  </action>
  <verify>
    File exists and exports useGameLoop
    No TypeScript errors
  </verify>
  <done>
    Fixed-timestep game loop hook ready for use
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimeDisplay component and Game wrapper</name>
  <files>
    src/components/TimeDisplay.tsx
    src/components/Game.tsx
    src/App.tsx
  </files>
  <action>
Create src/components/TimeDisplay.tsx:
- Use observer() from mobx-react-lite (CRITICAL - component must re-render on state changes)
- Display using DaisyUI `stats` component:
  - Day stat: "Day X of 10"
  - Time stat: HH:MM with timeOfDay descriptor
  - Pause/Play button (btn-circle btn-primary)
- Use lucide-react Play and Pause icons
- Call timeStore.togglePause() on button click

Create src/components/Game.tsx:
- Main game component that runs the loop
- Use useCallback for tick handler to prevent unnecessary re-renders
- Call store.tick(deltaMs) in the callback
- Pass timeStore.isPaused to useGameLoop options
- Render TimeDisplay component
- Add placeholder div for game world ("Game World Area" text)

Update src/App.tsx:
- Import and render Game component
- Remove any temporary test code from Plan 01
  </action>
  <verify>
    npm run dev shows TimeDisplay with Day 1, time 07:00
    Watch time advance (07:00 -> 07:01 -> ...) in real-time
    Click pause button - time freezes
    Click play button - time resumes
    Day increments after hour 24
  </verify>
  <done>
    Time advances visibly with pause/play control
    Day counter increments correctly
    TIME-01, TIME-02, TIME-03, TIME-04 requirements met
  </done>
</task>

</tasks>

<verification>
1. Time display shows "Day 1" and "07:00" on load
2. Time advances smoothly (visible minute changes every ~6 real seconds at gameSpeed=10)
3. Pause button stops time advancement
4. Play button resumes time from where it stopped
5. Day increments when hour passes 24 (can be verified by temporarily setting gameSpeed=600 for fast testing)
6. No console errors or MobX warnings
</verification>

<success_criteria>
- Game loop runs at stable frame rate
- Time advances: minutes, hours, days
- Pause/play toggle works correctly
- TimeDisplay reactively updates as MobX state changes
- Player can observe time passing (core visibility requirement)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
