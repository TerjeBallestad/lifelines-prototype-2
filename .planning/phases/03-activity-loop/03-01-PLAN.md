---
phase: 03-activity-loop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/game.ts
  - src/data/skills.ts
  - src/data/activities.ts
  - src/stores/SkillStore.ts
  - src/stores/ResourceStore.ts
  - src/stores/RootStore.ts
autonomous: true

must_haves:
  truths:
    - "Skill types exist with 4 categories (Practical, Creative, Social, Technical)"
    - "Resource types exist (creativity, food, cleanliness, comfort, connection, progress)"
    - "SkillStore tracks XP and computed level for each skill"
    - "ResourceStore tracks global resource counts"
    - "Activities have skillCategory and outputs defined"
  artifacts:
    - path: "src/types/game.ts"
      provides: "Skill, SkillCategory, ResourceType, ActivityOutput types"
      contains: "SkillCategory"
    - path: "src/data/skills.ts"
      provides: "Skill definitions, XP thresholds, output modifiers"
      min_lines: 30
    - path: "src/stores/SkillStore.ts"
      provides: "SkillStore class with XP tracking and computed levels"
      exports: ["SkillStore", "CharacterSkill"]
    - path: "src/stores/ResourceStore.ts"
      provides: "ResourceStore class with resource counts"
      exports: ["ResourceStore"]
  key_links:
    - from: "src/stores/RootStore.ts"
      to: "SkillStore, ResourceStore"
      via: "store initialization"
      pattern: "new SkillStore|new ResourceStore"
    - from: "src/data/activities.ts"
      to: "src/types/game.ts"
      via: "skillCategory property"
      pattern: "skillCategory:"
---

<objective>
Create the type system and stores for skills and resources.

Purpose: Skills and resources are the foundation for Phase 3's progression system. Without these types and stores, activities cannot produce output or train skills.

Output: TypeScript types for skills/resources, SkillStore with XP tracking, ResourceStore for global counters, and extended Activity definitions.
</objective>

<execution_context>
@/Users/godstemning/.claude/get-shit-done/workflows/execute-plan.md
@/Users/godstemning/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-activity-loop/03-CONTEXT.md
@.planning/phases/03-activity-loop/03-RESEARCH.md

@src/types/game.ts
@src/data/activities.ts
@src/stores/RootStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skill and resource types to game.ts</name>
  <files>src/types/game.ts</files>
  <action>
Add the following types to src/types/game.ts:

1. SkillCategory type:
```typescript
export type SkillCategory = 'Practical' | 'Creative' | 'Social' | 'Technical';
```

2. ResourceType type:
```typescript
export type ResourceType =
  | 'creativity'   // Blue-adjacent, from reading/thinking
  | 'food'         // Green/White, from cooking
  | 'cleanliness'  // White, from cleaning
  | 'comfort'      // Green, from resting
  | 'connection'   // Social activities
  | 'progress';    // General accomplishment feeling
```

3. ActivityOutput interface:
```typescript
export interface ActivityOutput {
  resource: ResourceType;
  baseAmount: number;
}
```

4. Extend Activity interface to add:
```typescript
  skillCategory?: SkillCategory;  // Which skill this activity trains
  outputs?: ActivityOutput[];     // Resources produced on completion
  difficulty?: number;            // 1-3, default 1
```

5. Add SkillData interface:
```typescript
export interface SkillData {
  id: string;
  name: string;
  category: SkillCategory;
  description: string;
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Types exist and compile: SkillCategory, ResourceType, ActivityOutput, SkillData, extended Activity</done>
</task>

<task type="auto">
  <name>Task 2: Create skill definitions and activity mappings</name>
  <files>src/data/skills.ts, src/data/activities.ts</files>
  <action>
Create src/data/skills.ts with:

1. XP_THRESHOLDS constant array: [0, 100, 300, 600, 1000] for levels 1-5

2. OUTPUT_MODIFIERS constant array: [1.0, 1.0, 1.2, 1.5, 1.8, 2.0] (index 0 unused, 1-5 for levels)

3. SKILLS array with skill definitions:
- cooking (Practical) - "Preparing food efficiently"
- cleaning (Practical) - "Maintaining living spaces"
- reading (Creative) - "Deep comprehension and focus"
- thinking (Creative) - "Problem solving and analysis"
- phone (Social) - "Communication and calling for help"
- socializing (Social) - "Connecting with others"

4. Helper functions:
- getLevelFromXP(xp: number): number - returns level 1-5 based on thresholds
- getXPToNextLevel(xp: number, level: number): number - XP needed for next level
- getLevelProgress(xp: number, level: number): number - 0-1 progress within level
- getOutputModifier(level: number): number - returns modifier for level

Update src/data/activities.ts:

Add skillCategory and outputs to each activity:
- reading: skillCategory 'Creative', outputs [{resource: 'creativity', baseAmount: 15}]
- thinking: skillCategory 'Creative', outputs [{resource: 'creativity', baseAmount: 10}]
- cooking: skillCategory 'Practical', outputs [{resource: 'food', baseAmount: 20}]
- cleaning: skillCategory 'Practical', outputs [{resource: 'cleanliness', baseAmount: 15}]
- check-elling: skillCategory 'Social', outputs [{resource: 'connection', baseAmount: 5}]
- watch-tv: no skill (undefined), outputs [{resource: 'comfort', baseAmount: 5}]
- phone: skillCategory 'Social', outputs [{resource: 'connection', baseAmount: 10}]
- rest: no skill, outputs [{resource: 'comfort', baseAmount: 10}]
- Comfort behaviors: no skill, no outputs (recovery only)

Add difficulty to activities requiring skill:
- cooking: difficulty 2
- reading: difficulty 1
- phone: difficulty 2
- Others: difficulty 1 or undefined
  </action>
  <verify>
Import SKILLS and helper functions in a test file or via console:
- getLevelFromXP(0) === 1
- getLevelFromXP(100) === 2
- getLevelFromXP(1000) === 5
- getOutputModifier(3) === 1.5
  </verify>
  <done>
skills.ts exports SKILLS, XP_THRESHOLDS, OUTPUT_MODIFIERS, and helper functions.
activities.ts has skillCategory and outputs on all regular activities.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create SkillStore and ResourceStore</name>
  <files>src/stores/SkillStore.ts, src/stores/ResourceStore.ts, src/stores/RootStore.ts</files>
  <action>
Create src/stores/SkillStore.ts:

1. CharacterSkill class (MobX observable):
```typescript
export class CharacterSkill {
  category: SkillCategory;
  xp: number = 0;

  constructor(category: SkillCategory) {
    this.category = category;
    makeAutoObservable(this);
  }

  // Computed: level from XP using getLevelFromXP helper
  get level(): number { ... }

  // Computed: XP needed for next level
  get xpToNextLevel(): number { ... }

  // Computed: progress 0-1 within current level
  get levelProgress(): number { ... }

  // Action: grant XP
  grantXP(amount: number): void { this.xp += amount; }
}
```

2. SkillStore class:
```typescript
export class SkillStore {
  // Map of characterId -> Map of SkillCategory -> CharacterSkill
  characterSkills: Map<string, Map<SkillCategory, CharacterSkill>> = new Map();

  readonly rootStore: RootStore;

  constructor(rootStore: RootStore) { ... }

  // Initialize skills for a character with optional starting XP based on colors
  initializeCharacterSkills(characterId: string, colors: MTGColorProfile): void { ... }

  // Get skill for character
  getSkill(characterId: string, category: SkillCategory): CharacterSkill | undefined { ... }

  // Grant XP to a character's skill
  grantXP(characterId: string, category: SkillCategory, amount: number): void { ... }
}
```

Skill initialization based on MTG colors:
- Blue primary: Creative starts at level 2 (100 XP)
- White primary: Practical starts at level 2 (100 XP)
- Green primary: Practical starts at level 2 (100 XP)
- Red primary: Social starts at level 2 (100 XP)
- Black primary: Technical starts at level 2 (100 XP)

Create src/stores/ResourceStore.ts:

```typescript
export class ResourceStore {
  resources: Map<ResourceType, number> = new Map();

  readonly rootStore: RootStore;

  constructor(rootStore: RootStore) {
    this.rootStore = rootStore;
    makeAutoObservable(this, { rootStore: false });

    // Initialize all resources to 0
    const types: ResourceType[] = ['creativity', 'food', 'cleanliness', 'comfort', 'connection', 'progress'];
    for (const type of types) {
      this.resources.set(type, 0);
    }
  }

  getResource(type: ResourceType): number {
    return this.resources.get(type) ?? 0;
  }

  addResource(type: ResourceType, amount: number): void {
    const current = this.getResource(type);
    this.resources.set(type, current + amount);
  }
}
```

Update src/stores/RootStore.ts:
1. Import SkillStore and ResourceStore
2. Add properties: skillStore and resourceStore
3. Create in constructor: this.skillStore = new SkillStore(this); this.resourceStore = new ResourceStore(this);
4. After characterStore creation, initialize skills for each character
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
In browser console or test:
- rootStore.skillStore exists
- rootStore.resourceStore exists
- rootStore.skillStore.getSkill('elling', 'Creative')?.level === 2 (Blue starts with Creative boost)
  </verify>
  <done>
SkillStore and ResourceStore exist, are initialized in RootStore, and Elling has Creative level 2 due to Blue primary color.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. `npm run dev` starts without errors
3. In browser console:
   - `rootStore.skillStore.getSkill('elling', 'Creative')?.level` returns 2
   - `rootStore.resourceStore.getResource('creativity')` returns 0
   - Activity definitions include skillCategory and outputs
</verification>

<success_criteria>
- All new types compile without errors
- SkillStore initializes character skills with MTG color bonuses
- ResourceStore tracks all 6 resource types
- Activities have skillCategory and outputs defined
- Helper functions correctly calculate levels from XP
</success_criteria>

<output>
After completion, create `.planning/phases/03-activity-loop/03-01-SUMMARY.md`
</output>
